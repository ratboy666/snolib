<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type"
      content="text/html; charset=UTF-8">
<meta name="description"
      content="sweave generated">
</head><body><font face="Sorts Mill Goudy">
<p align="justify"><font face="Sorts Mill Goudy">
<h1>P64 - Pointer Utilities</h1>
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
Pointer utilities Includes peek and poke of various types (_p = pointer,
_c = char, _s = short, _i = int, _f = float, _d = double, _ld = long
double). Note that long long is excluded.
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
Defines interface to malloc(), free(), strdup() and strlen().
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
<font face="Source Code Pro">INCLUDE</font>s used while building p64.so are:
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
<a href="CRACK.html">CRACK</a><br>
<a href="DYNAMIC.html">DYNAMIC</a><br>
<a href="SEQ.html">SEQ</a><br>
<a href="WRAPPER.html">WRAPPER</a>
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
<h2>Uses</h2>
</font></p>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;INCLUDES&raquo;&equiv;</b>
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64&raquo;&equiv;</b>
-MODULE P64
-CASE 1
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64&raquo;&equiv;</b>
-SNOBOL TERMINAL = &#39;P64 (SUN NOV 10 03:57:08 EST 2013)&#39;
-SNOBOL SLOAD(&#39;CRACK.INC&#39;)
-SNOBOL SLOAD(&#39;DYNAMIC.INC&#39;)
-SNOBOL SLOAD(&#39;SEQ.INC&#39;)
-SNOBOL SLOAD(&#39;WRAPPER.INC&#39;)
<b>@</b>
</font></pre></div>
<p align="justify"><font face="Sorts Mill Goudy">
Build <font face="Source Code Pro">p64.c</font> so we can produce our shared library.
</font></p>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64&raquo;&equiv;</b>
-EMBED C &#39;p64&#39;
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64,TYPE=C&raquo;&equiv;</b>
-SNOBOL WRAPPER_STARTFILE(.EMBED)

<font color="#818181"><i>#include &lt;stdlib.h&gt;</i></font>
<font color="#818181"><i>#include &lt;string.h&gt;</i></font>

static long peek_p(long p) { return (long)*(void **)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_P(LONG)LONG&#39;, .EMBED)

static long peek_c(long p) { return *(char *)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_C(LONG)INTEGER&#39;, .EMBED)

static long peek_s(long p) { return *(short *)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_S(LONG)INTEGER&#39;, .EMBED)

static long peek_i(long p) { return *(int *)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_I(LONG)INTEGER&#39;, .EMBED)

static double peek_d(long p) { return *(double *)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_D(LONG)REAL&#39;, .EMBED)

static double peek_f(long p) { return *(float *)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_F(LONG)REAL&#39;, .EMBED)

static double peek_ld(long p) { return *(long double *)p; }

-SNOBOL C_WRAPPER_PROTO(&#39;PEEK_LD(LONG)REAL&#39;, .EMBED)

static void poke_p(long p, long v) { *(void **)p = (void *)v; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_P(LONG,LONG)&#39;, .EMBED)

static void poke_c(long p, int c) { *(char *)p = (char)c; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_C(LONG,INTEGER)&#39;, .EMBED)

static void poke_s(long p, int s) { *(short *)p = (short)s; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_S(LONG,INTEGER)&#39;, .EMBED)

static void poke_i(long p, int i) { *(int *)p = (int)i; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_I(LONG,INTEGER)&#39;, .EMBED)

static void poke_d(long p, double v) { *(double *)p = v; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_D(LONG,REAL)&#39;, .EMBED)

static void poke_f(long p, double v) { *(float *)p = v; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_F(LONG,REAL)&#39;, .EMBED)

static void poke_ld(long p, double v) { *(long double *)p = v; }

-SNOBOL C_WRAPPER_PROTO(&#39;POKE_LD(LONG,REAL)&#39;, .EMBED)

static long malloc_(int n) { return (long)malloc(n); }

-SNOBOL C_WRAPPER_PROTO(&#39;MALLOC_(INTEGER)LONG&#39;, .EMBED)

static void free_(long p) { free((void *)p); }

-SNOBOL C_WRAPPER_PROTO(&#39;FREE_(LONG)&#39;, .EMBED)

static long strdup_(char *s) { return (long)strdup(s); }

-SNOBOL C_WRAPPER_PROTO(&#39;STRDUP_(STRING)LONG&#39;, .EMBED)

static long strlen_(long p) { return strlen((char *)p); }

-SNOBOL C_WRAPPER_PROTO(&#39;STRLEN_(LONG)INTEGER&#39;, .EMBED)

-END
<b>@</b>
</font></pre></div>
<p align="justify"><font face="Sorts Mill Goudy">
Build <font face="Source Code Pro">p64.so</font> shared library.
</font></p>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64&raquo;&equiv;</b>
-SNOBOL DYNAMIC_DEBUG = 1
-SNOBOL COMPILE_DYNAMIC(p64) :F(ERROR) ;
-SNOBOL OBJECTS = p64; OBJECTS &#39;.c&#39; = &#39;.o&#39;
-SNOBOL LINK_DYNAMIC(&#39;./p64&#39;, OBJECTS) :F(ERROR) ;
-CMNT ERASE TEMPORARY FILES
-CMNT     WE DON&#39;T NEED THE C BITS, OR THE OBJECT FILES ANYMORE.
-CMNT     ALL WE REQUIRE IS p64.so
-CMNT -SNOBOL A = CRACK(p64 &#39; &#39; OBJECTS, &#39; &#39;)
-CMNT -SNOBOL SEQ(&#39; DELETE(A&lt;K&gt;) &#39;, .K)
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64&raquo;&equiv;</b>
-PUBLIC PEEK_P(), PEEK_C(), PEEK_S(), PEEK_I(), PEEK_D(), PEEK_F()
-PUBLIC PEEK_LD()
-PUBLIC POKE_P(), POKE_C(), POKE_S(), POKE_I(), POKE_D(), POKE_F()
-PUBLIC POKE_LD()
<font color="#818181"><i>*</i></font>
         LOAD(&#39;PEEK_P(INTEGER)INTEGER&#39;, &#39;p64.so&#39;)
         LOAD(&#39;PEEK_C(INTEGER)INTEGER&#39;, &#39;p64.so&#39;)
         LOAD(&#39;PEEK_S(INTEGER)INTEGER&#39;, &#39;p64.so&#39;)
         LOAD(&#39;PEEK_I(INTEGER)INTEGER&#39;, &#39;p64.so&#39;)
         LOAD(&#39;PEEK_D(INTEGER)REAL&#39;, &#39;p64.so&#39;)
         LOAD(&#39;PEEK_F(INTEGER)REAL&#39;, &#39;p64.so&#39;)
         LOAD(&#39;PEEK_LD(INTEGER)REAL&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_P(INTEGER,INTEGER)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_C(INTEGER,INTEGER)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_S(INTEGER,INTEGER)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_I(INTEGER,INTEGER)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_D(INTEGER,REAL)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_F(INTEGER,REAL)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;POKE_LD(INTEGER,REAL)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;MALLOC_(INTEGER)INTEGER&#39;, &#39;p64.so&#39;)
         LOAD(&#39;FREE_(INTEGER)&#39;, &#39;p64.so&#39;)
         LOAD(&#39;STRDUP_(STRING)INTEGER&#39;, &#39;p64.so&#39;)
         LOAD(&#39;STRLEN_(INTEGER)INTEGER&#39;, &#39;p64.so&#39;)
<font color="#818181"><i>*</i></font>
<b>@</b>
</font></pre></div>
<p align="justify"><font face="Sorts Mill Goudy">
Define the actual “API” for the P64 module.
</font></p>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;P64&raquo;&equiv;</b>
-PUBLIC MALLOC(), FREE(), STRDUP(), STRLEN()
         DEFINE(&#39;MALLOC(N)&#39;)
         DEFINE(&#39;FREE(P)&#39;)
         DEFINE(&#39;STRDUP(S)&#39;)
         DEFINE(&#39;STRLEN(P)&#39;)                                  <b>:(P64_END)</b>
<font color="#818181"><i>*</i></font>
MALLOC   MALLOC = MALLOC_(N)                                   <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
FREE     FREE_(P)                                              <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
STRDUP   STRDUP = STRDUP_(S)                                   <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
STRLEN   STRLEN = STRLEN_(P)                                   <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
P64_END
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;unit_test&raquo;&equiv;</b>
<font color="#818181"><i>#!/usr/bin/bash</i></font>
         exec &quot;snobol4&quot; &quot;-b&quot; &quot;$0&quot; &quot;$@&quot;
-INCLUDE &#39;P64.INC&#39;
         &amp;CODE = 1
         &amp;CODE = 0
END
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;&raquo;&equiv;</b>
-STITL P64
-EJECT
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>************************************************************************</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>*                       ######    ###   #   #                          *</i></font>
<font color="#818181"><i>*                       #     #  #   #  #   #                          *</i></font>
<font color="#818181"><i>*                       #     #  #      #   #                          *</i></font>
<font color="#818181"><i>*                       ######   ####   #####                          *</i></font>
<font color="#818181"><i>*                       #        #   #      #                          *</i></font>
<font color="#818181"><i>*                       #        #   #      #                          *</i></font>
<font color="#818181"><i>*                       #         ###       #                          *</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>* P64                    POINTER UTILITIES                             *</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>************************************************************************</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* P64.lss</i></font>
<font color="#818181"><i>*</i></font>
<b>&laquo;P64&raquo;</b>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* CE: .F.MSNOBOL4;</i></font>
<b>@</b>
</font></pre></div>
<footer><hr><table width="100%" border="0">
<tr><td><p align=left>
Produced by <code>sweave</code>
</p></td><td><p align=center>
Sun Jun  8 17:21:50 EDT 2014</p></td><td><p align=right>
Return to <a href="index.html">index</a>
</p></td></table></footer>
</font></body></html>
