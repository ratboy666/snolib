<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type"
      content="text/html; charset=UTF-8">
<meta name="description"
      content="sweave generated">
</head><body><font face="Sorts Mill Goudy">
<p align="justify"><font face="Sorts Mill Goudy">
<h1>WRAPPER - Create C code to wrap a function for LOAD()ing</h1>
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
Writes a C function to do parameter and result conversion to allow
an external function to be used with <font face="Source Code Pro">LOAD()</font>.
</font></p>
<p align="justify"><font face="Sorts Mill Goudy">
<h2>Uses</h2>
</font></p>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;INCLUDES&raquo;&equiv;</b>
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;WRAPPER&raquo;&equiv;</b>
         WPMAXSTR = 1024
         WPSTRTYPE = &#39;STRING&#39;
         WPSTRFREE = &#39;STRING_FREE&#39;
         WPSTRTYP2 = &#39;STRING2&#39;
         WPINTTYPE = &#39;INTEGER&#39;
         WPPTRTYPE = &#39;POINTER&#39;
         WPLONGTYPE = &#39;LONG&#39;
         WPREALTYPE = &#39;REAL&#39;
         WPREDTYPE = &#39;PREDICATE&#39;
         WPSPREDTYPE = &#39;SYSPRED&#39;
         WPTYPES = WPLONGTYPE | WPINTTYPE | WPREALTYPE | WPSTRTYPE |
+                  WPPTRTYPE
         WPRTYPES = WPTYPES | WPREDTYPE | WPSPREDTYPE | WPSTRFREE |
+                   WPSTRTYP2 | &#39;&#39;
         WPNAME = ANY(&amp;UCASE &amp;LCASE &#39;_&#39;)
+                 SPAN(&amp;UCASE &amp;LCASE &#39;0123456789_&#39;)
         WPEND = ANY(&#39;,)&#39;)
         WP4SP = &#39;    &#39;
         WP8SP = &#39;	&#39;
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* WRAPPER_STARTFILE(OUTPUT_NAME)</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* OUTPUT_NAME: THE NAME (STRING) OF OUTPUT VAR FOR C FILE</i></font>
<font color="#818181"><i>*</i></font>
-PUBLIC WRAPPER_STARTFILE()
         DEFINE(&#39;WRAPPER_STARTFILE(FN)&#39;)        <b>:(WRAPPER_STARTFILE_END)</b>
<font color="#818181"><i>*</i></font>
WRAPPER_STARTFILE
         $FN = &#39;/* Generated by WRAPPER on &#39; DATE() &#39; */&#39;
         $FN =
         $FN = &#39;#include &quot;config.h&quot;&#39;
         $FN = &#39;#include &quot;h.h&quot;&#39;
         $FN = &#39;#include &quot;snotypes.h&quot;&#39;
         $FN = &#39;#include &quot;macros.h&quot;&#39;
         $FN = &#39;#include &quot;load.h&quot;&#39;
         $FN = &#39;#include &quot;equ.h&quot;&#39;
         $FN = &#39;#include &lt;string.h&gt;&#39;
         $FN =                                                 <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
WRAPPER_STARTFILE_END
<font color="#818181"><i>*</i></font>
-PUBLIC WRAPPER_COBOL()
         DEFINE(&#39;WRAPPER_COBOL(FN)&#39;)                <b>:(WRAPPER_COBOL_END)</b>
<font color="#818181"><i>*</i></font>
WRAPPER_COBOL
         $FN = &#39;#include &lt;libcob.h&gt;&#39;                           <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
WRAPPER_COBOL_END
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* WRAPPER_PROTO(PROTOTYPE,OUTPUT_NAME)</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* PROTOTYPE:   A PROTOTYPE, AS PASSED TO SNOBOL LOAD() FUNCTION</i></font>
<font color="#818181"><i>*              C FUNCTION TO CALL IS THE LOWERCASE VERSION</i></font>
<font color="#818181"><i>*              OF THE FUNCTION NAME.</i></font>
<font color="#818181"><i>* OUTPUT_NAME: THE NAME (STRING) OF OUTPUT VARIABLE FOR C FILE</i></font>
<font color="#818181"><i>*</i></font>
-PUBLIC WRAPPER_PROTO(), C_WRAPPER_PROTO(), COBOL_WRAPPER_PROTO()
-PUBLIC SCHEME_WRAPPER_PROTO()
         DEFINE(&#39;WRAPPER_PROTO(PROTO,FN,LEN)TYPES,I,N,C,CALL&#39;)
         DEFINE(&#39;C_WRAPPER_PROTO(PROTO,FN,LEN)TYPES,I,N,C,CALL&#39;,
+           &#39;WRAPPER_PROTO&#39;)
         DEFINE(&#39;COBOL_WRAPPER_PROTO(PROTO,FN,LEN)TYPES,I,N,C,CALL&#39;,
+           &#39;WRAPPER_PROTO&#39;)
         DEFINE(&#39;SCHEME_WRAPPER_PROTO(PROTO,FN,LEN)TYPES,I,N,C,CALL&#39;,
+           &#39;WRAPPER_PROTO&#39;)                        <b>:(WRAPPER_PROTO_END)</b>
<font color="#818181"><i>*</i></font>
WRAPPER_PROTO
         $FN =
         $FN = &#39;/* &#39; PROTO &#39; */&#39;
         PROTO POS(0) WPNAME . NAME &#39;(&#39; =                      <b>:F(WPERR)</b>
         N = 0
         WPCOPY = 0
         TYPES = ARRAY(&#39;0:29&#39;)
         PROTO POS(0) &#39;)&#39; =                                  <b>:S(WPEPARS)</b>
WPLOOP   PROTO WPTYPES . TYPE WPEND . C =                      <b>:F(WPERR)</b>
         TYPES&lt;N&gt; = TYPE                                       <b>:F(WPERR)</b>
         N = N + 1
         WPCOPY = IDENT(TYPE, WPSTRTYPE) WPCOPY + 1
         IDENT(C, &#39;)&#39;)                              <b>:S(WPEPARS)F(WPLOOP)</b>
WPERR    TERMINAL = &#39;ERROR IN PROTOTYPE: &gt;&#39; PROTO &#39;&lt;&#39;         <b>:(FRETURN)</b>
WPEPARS  PROTO POS(0) WPRTYPES RPOS(0)                         <b>:F(WPERR)</b>
         I = 0
         $FN = NAME &#39;( LA_ALIST ) LA_DCL&#39;
         $FN = &#39;{&#39;
         EQ(WPCOPY, 0)                                      <b>:S(WPNOSTRS)</b>
<font color="#818181"><i>*</i></font>
WPLOOP2  IDENT(TYPES&lt;I&gt;, WPSTRTYPE)                          <b>:F(WPNEXT2)</b>
         $FN = WP4SP &#39;char arg&#39; I &#39;[&#39; WPMAXSTR &#39;];&#39;
WPNEXT2  I = I + 1
         LT(I, N)                                            <b>:S(WPLOOP2)</b>
<font color="#818181"><i>*</i></font>
         I = 0
WPCOPY                                           <b>:($(&#39;WPCPY_&#39; TYPES&lt;I&gt;))</b>
WPCPY_STRING
         $FN = WP4SP
+              &#39;getstring(LA_PTR(&#39; I &#39;), arg&#39; I &#39;, sizeof(arg&#39; I &#39;));&#39;
                                                              <b>:(WPNCOPY)</b>
WPCPY_LONG
WPCPY_INTEGER
WPCPY_REAL
WPCPY_POINTER
WPCPY_
WPNCOPY  I = I + 1
         LT(I, N)                                             <b>:S(WPCOPY)</b>
<font color="#818181"><i>*</i></font>
WPNOSTRS CALL = REPLACE(NAME, &amp;UCASE, &amp;LCASE) &#39;(&#39;
         I = 0
WPCALL   GE(I, N)                                            <b>:S(WPECALL)</b>
         CALL = GT(I, 0) CALL &#39;,&#39;                <b>:($(&#39;WPARG_&#39; TYPES&lt;I&gt;))</b>
WPARG_POINTER
         CALL = CALL &#39;(void *)(long)LA_INT(&#39; I &#39;)&#39;            <b>:(WPNCALL)</b>
WPARG_LONG
         CALL = CALL &#39;(long)LA_INT(&#39; I &#39;)&#39;                    <b>:(WPNCALL)</b>
WPARG_INTEGER
         CALL = CALL &#39;(int)LA_INT(&#39; I &#39;)&#39;                     <b>:(WPNCALL)</b>
WPARG_REAL
         CALL = CALL &#39;(double)LA_REAL(&#39; I &#39;)&#39;                 <b>:(WPNCALL)</b>
WPARG_STRING
         CALL = CALL &#39;arg&#39; I
WPNCALL  I = I + 1                                             <b>:(WPCALL)</b>
WPECALL  CALL = CALL &#39;)&#39;                            <b>:($(&#39;WPRET_&#39; PROTO))</b>
<font color="#818181"><i>*</i></font>
WPRET_STRING
         $FN = WP4SP &#39;RETSTR((char *)&#39; CALL &#39;);&#39;               <b>:(WPDONE)</b>
WPRET_STRING2
         $FN = WP4SP &#39;RETSTR2((char *)&#39; CALL &#39;,&#39; LEN &#39;);&#39;      <b>:(WPDONE)</b>
WPRET_STRING_FREE
         $FN = WP4SP &#39;RETSTR_FREE((char *)&#39; CALL &#39;);&#39;          <b>:(WPDONE)</b>
WPRET_POINTER
         $FN = WP4SP &#39;RETINT((long)&#39; CALL &#39;);&#39;                 <b>:(WPDONE)</b>
WPRET_LONG
         $FN = WP4SP &#39;RETINT((long)&#39; CALL &#39;);&#39;                 <b>:(WPDONE)</b>
WPRET_INTEGER
         $FN = WP4SP &#39;RETINT(&#39; CALL &#39;);&#39;                       <b>:(WPDONE)</b>
WPRET_REAL
         $FN = WP4SP &#39;RETREAL(&#39; CALL &#39;);&#39;                      <b>:(WPDONE)</b>
WPRET_PREDICATE
         $FN = WP4SP &#39;if (&#39; CALL &#39;)&#39;
         $FN = WP8SP &#39;RETNULL;&#39;
         $FN = WP4SP &#39;RETFAIL;&#39;                                <b>:(WPDONE)</b>
<font color="#818181"><i>* SYSTEM CALL (&lt; 0 FOR FAILURE)</i></font>
WPRET_SYSPRED
         $FN = WP4SP &#39;if (&#39; CALL &#39; &gt;= 0)&#39;
         $FN = WP8SP &#39;RETNULL;&#39;
         $FN = WP4SP &#39;RETFAIL;&#39;                                <b>:(WPDONE)</b>
WPRET_
         $FN = WP4SP CALL &#39;;&#39;
         $FN = WP4SP &#39;RETNULL;&#39;
<font color="#818181"><i>* END OF FUNCTION</i></font>
WPDONE   $FN = &#39;}&#39;                                             <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
WRAPPER_PROTO_END
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* FWRAPPER</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* MAKE WRAPPER FOR FORTRAN FUNCTION</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* SIMILAR TO C WRAPPER, BUT:</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>*     - ALL PARAMETERS NEED TO BE COPIED</i></font>
<font color="#818181"><i>*     - STRINGS ARE PASSED AS TWO PARAMETERS</i></font>
<font color="#818181"><i>*     - STRING RETURN IS AN ADDED PARAMETER ON THE FRONT OF THE ARG</i></font>
<font color="#818181"><i>*       LIST</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* FWRAPPER_PROTO(PROTO,FN,LEN)</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* PROTO:   A PROTOTYPE, AS PASSED TO SNOBOL LOAD() FUNCTION</i></font>
<font color="#818181"><i>*          FORTRAN FUNCTION TO CALL IS THE LOWERCASE VERSION</i></font>
<font color="#818181"><i>*          OF THE FUNCTION NAME WITH _ APPENDED.</i></font>
<font color="#818181"><i>* FN:      THE NAME (STRING) OF OUTPUT VARIABLE FOR C FILE</i></font>
<font color="#818181"><i>*</i></font>
-PUBLIC FWRAPPER_PROTO(), FORTRAN_WRAPPER_PROTO()
         DEFINE(&#39;FWRAPPER_PROTO(PROTO,FN,LEN)TYPES,I,N,C,CALL&#39;)
         DEFINE(&#39;FORTRAN_WRAPPER_PROTO(PROTO,FN,LEN)TYPES,I,N,C,CALL&#39;,
+           &#39;FWRAPPER_PROTO&#39;)                      <b>:(FWRAPPER_PROTO_END)</b>
<font color="#818181"><i>*</i></font>
FWRAPPER_PROTO
         $FN =
         $FN = &#39;/* FORTRAN &#39; PROTO &#39; */&#39;
         PROTO POS(0) WPNAME . NAME &#39;(&#39; =                      <b>:F(WPERR)</b>
         N = 0
         TYPES = ARRAY(&#39;0:29&#39;)
         PROTO POS(0) &#39;)&#39; =                                 <b>:S(FWPEPARS)</b>
FWPLOOP  PROTO WPTYPES . TYPE WPEND . C =                      <b>:F(WPERR)</b>
         TYPES&lt;N&gt; = TYPE                                       <b>:F(WPERR)</b>
         N = N + 1
         IDENT(C, &#39;)&#39;)                            <b>:S(FWPEPARS)F(FWPLOOP)</b>
FWPEPARS WPCOPY = N
         PROTO POS(0) WPRTYPES RPOS(0)                         <b>:F(WPERR)</b>
         I = 0
         $FN = NAME &#39;( LA_ALIST ) LA_DCL&#39;
         $FN = &#39;{&#39;
         $FN = IDENT(PROTO, WPREALTYPE)
+           WP4SP &#39;double &#39; REPLACE(NAME, &amp;UCASE, &amp;LCASE) &#39;_();&#39;
         $FN = IDENT(PROTO, WPSTRTYPE)
+           WP4SP &#39;char result[&#39; WPMAXSTR &#39;];&#39;
         EQ(WPCOPY, 0)                                     <b>:S(FWPNOSTRS)</b>
<font color="#818181"><i>*</i></font>
FWPLOOP2 $FN = IDENT(TYPES&lt;I&gt;, WPSTRTYPE)
+           WP4SP &#39;char arg&#39; I &#39;[&#39; WPMAXSTR &#39;];&#39;            <b>:S(FWPNEXT2)</b>
         $FN = IDENT(TYPES&lt;I&gt;, WPLONGTYPE)
+           WP4SP &#39;long arg&#39; I &#39;;&#39;                          <b>:S(FWPNEXT2)</b>
         $FN = IDENT(TYPES&lt;I&gt;, WPINTTYPE)
+           WP4SP &#39;int arg&#39; I &#39;;&#39;                           <b>:S(FWPNEXT2)</b>
         $FN = IDENT(TYPES&lt;I&gt;, WPREALTYPE)
+           WP4SP &#39;double arg&#39; I &#39;;&#39;                        <b>:S(FWPNEXT2)</b>
FWPNEXT2 I = I + 1
         LT(I, N)                                           <b>:S(FWPLOOP2)</b>
<font color="#818181"><i>*</i></font>
         I = 0
FWPCOPY                                         <b>:($(&#39;FWPCPY_&#39; TYPES&lt;I&gt;))</b>
FWPCPY_STRING
         $FN = WP4SP
+              &#39;getstring(LA_PTR(&#39; I &#39;), arg&#39; I &#39;, sizeof(arg&#39; I &#39;));&#39;
                                                             <b>:(FWPNCOPY)</b>
FWPCPY_LONG
         $FN = WP4SP &#39;arg&#39; I &#39; = (long)LA_INT(&#39; I &#39;);&#39;       <b>:(FWPNCOPY)</b>
FWPCPY_INTEGER
         $FN = WP4SP &#39;arg&#39; I &#39; = (int)LA_INT(&#39; I &#39;);&#39;        <b>:(FWPNCOPY)</b>
FWPCPY_REAL
         $FN = WP4SP &#39;arg&#39; I &#39; = (double)LA_REAL(&#39; I &#39;);&#39;    <b>:(FWPNCOPY)</b>
FWPCPY_
FWPNCOPY I = I + 1
         LT(I, N)                                            <b>:S(FWPCOPY)</b>
<font color="#818181"><i>*</i></font>
FWPNOSTRS
         CALL = REPLACE(NAME, &amp;UCASE, &amp;LCASE) &#39;_(&#39;
         I = 0
FWPCALL  GE(I, N)                                           <b>:S(FWPECALL)</b>
         CALL = GT(I, 0) CALL &#39;,&#39;               <b>:($(&#39;FWPARG_&#39; TYPES&lt;I&gt;))</b>
FWPARG_LONG
FWPARG_INTEGER
FWPARG_REAL
         CALL = CALL &#39;&amp;arg&#39; I                                <b>:(FWPNCALL)</b>
FWPARG_STRING
         CALL = CALL &#39;arg&#39; I &#39;, strlen(arg&#39; I &#39;)&#39;
FWPNCALL I = I + 1                                            <b>:(FWPCALL)</b>
FWPECALL CALL = CALL &#39;)&#39;                           <b>:($(&#39;FWPRET_&#39; PROTO))</b>
<font color="#818181"><i>*</i></font>
FWPRET_STRING
         LEN = 1024
FWPRET_STRING2
         CALL &#39;()&#39; = &#39;(result, sizeof result)&#39;             <b>:S(FWPRETST2)</b>
         CALL &#39;(&#39; = &#39;(result, sizeof result,&#39;
FWPRETST2
         CALL = CALL &#39;, result&#39;
         $FN = WP4SP &#39;RETSTR2((&#39; CALL &#39;), &#39; LEN &#39;);&#39;          <b>:(FWPDONE)</b>
FWPRET_LONG
FWPRET_INTEGER
         $FN = WP4SP &#39;RETINT(&#39; CALL &#39;);&#39;                      <b>:(FWPDONE)</b>
FWPRET_REAL
         $FN = WP4SP &#39;RETREAL(&#39; CALL &#39;);&#39;                     <b>:(FWPDONE)</b>
FWPRET_PREDICATE
         $FN = WP4SP &#39;if (&#39; CALL &#39;)&#39;
         $FN = WP8SP &#39;RETNULL;&#39;
         $FN = WP4SP &#39;RETFAIL;&#39;                               <b>:(FWPDONE)</b>
<font color="#818181"><i>* SYSTEM CALL (&lt; 0 FOR FAILURE)</i></font>
FWPRET_SYSPRED
         $FN = WP4SP &#39;if (&#39; CALL &#39; &gt;= 0)&#39;
         $FN = WP8SP &#39;RETNULL;&#39;
         $FN = WP4SP &#39;RETFAIL;&#39;                               <b>:(FWPDONE)</b>
FWPRET_
         $FN = WP4SP CALL &#39;;&#39;
         $FN = WP4SP &#39;RETNULL;&#39;
<font color="#818181"><i>* END OF FUNCTION</i></font>
FWPDONE  $FN = &#39;}&#39;                                             <b>:(RETURN)</b>
<font color="#818181"><i>*</i></font>
FWRAPPER_PROTO_END
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;unit_test&raquo;&equiv;</b>
<font color="#818181"><i>#!/usr/bin/bash</i></font>
         exec &quot;snobol4&quot; &quot;-b&quot; &quot;$0&quot; &quot;$@&quot;
-INCLUDE &#39;WRAPPER.INC&#39;
         &amp;CODE = 1
         &amp;CODE = 0
END
<b>@</b>
</font></pre></div>
<div style="background-image: url(greenbar.gif)">
<pre><font face="Source Code Pro">
<b>&laquo;&raquo;&equiv;</b>
-MODULE WRAPPER
<b>&laquo;INCLUDES&raquo;</b>
-STITL WRAPPER
-EJECT
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>************************************************************************</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>*    #     #  ######      #     ######   ######   #######  ######      *</i></font>
<font color="#818181"><i>*    #  #  #  #     #    # #    #     #  #     #  #        #     #     *</i></font>
<font color="#818181"><i>*    #  #  #  #     #   #   #   #     #  #     #  #        #     #     *</i></font>
<font color="#818181"><i>*    #  #  #  ######   #     #  ######   ######   #####    ######      *</i></font>
<font color="#818181"><i>*    #  #  #  #   #    #######  #        #        #        #   #       *</i></font>
<font color="#818181"><i>*    #  #  #  #    #   #     #  #        #        #        #    #      *</i></font>
<font color="#818181"><i>*     ## ##   #     #  #     #  #        #        #######  #     #     *</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>* WRAPPER   CREATE C CODE TO WRAP A FUNCTION FOR LOAD()&#39;ING            *</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>* PHIL BUDNE, DECEMBER, 2001                                           *</i></font>
<font color="#818181"><i>*                                                                      *</i></font>
<font color="#818181"><i>************************************************************************</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* WRAPPER.lss</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* FMGW</i></font>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>*     STRING_FREE, FREE RETURNED STRING AFTER COPYING TO SNOBOL4</i></font>
<font color="#818181"><i>*     STRING2, REQUIRES LEN PARAMETER, COPY FIXED LENGTH</i></font>
<font color="#818181"><i>*     REMOVE HANDLE TYPE COMPLETELY</i></font>
<font color="#818181"><i>*</i></font>
<b>&laquo;WRAPPER&raquo;</b>
<font color="#818181"><i>*</i></font>
<font color="#818181"><i>* CE: .MSNOBOL4;</i></font>
<b>@</b>
</font></pre></div>
<footer><hr><table width="100%" border="0">
<tr><td><p align=left>
Produced by <code>sweave</code>
</p></td><td><p align=center>
Fri Jun 20 05:57:11 EDT 2014</p></td><td><p align=right>
Return to <a href="index.html">index</a>
</p></td></table></footer>
</font></body></html>
